{"id":"budgie-4q0","title":"Add input validation for directory parameter","description":"Current validation only checks if directory is non-empty.\n\nAdd validation for:\n- Directory must be absolute path\n- Directory must exist\n- Optionally: directory must be within allowed paths (security boundary)\n\nCurrent code:\n```go\nif input.Directory == \"\" {\n    return nil, ToolOutput{}, fmt.Errorf(\"directory is required\")\n}\n```\n\nShould become:\n```go\nif !filepath.IsAbs(input.Directory) {\n    return nil, ToolOutput{}, fmt.Errorf(\"directory must be absolute path\")\n}\nif _, err := os.Stat(input.Directory); os.IsNotExist(err) {\n    return nil, ToolOutput{}, fmt.Errorf(\"directory does not exist: %s\", input.Directory)\n}\n```","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-06T19:23:58.905361+01:00","created_by":"yildirimkaral","updated_at":"2026-01-06T19:23:58.905361+01:00"}
{"id":"budgie-bc1","title":"Return structured errors instead of error strings in response","description":"Current behavior returns errors as strings in response body:\n```go\nreturn nil, ToolOutput{\n    Response:  fmt.Sprintf(\"ERROR: %v\", result.Error),\n    SessionID: sessionID,\n}, nil\n```\n\nProblem: Orchestrator can't programmatically distinguish errors from valid responses.\n\nFix: Use MCP error mechanism or structured response:\n```go\nif result.Error != nil {\n    return \u0026mcp.CallToolResult{IsError: true}, ToolOutput{\n        Response:  result.Error.Error(),\n        SessionID: sessionID,\n    }, nil\n}\n```\n\nThis allows orchestrator to handle errors properly and implement retry logic.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-06T19:24:05.083494+01:00","created_by":"yildirimkaral","updated_at":"2026-01-06T19:24:05.083494+01:00"}
{"id":"budgie-cmi","title":"Remove hardcoded paths from agent configurations","description":"Some agent configs contain hardcoded user-specific paths:\n\ndeveloper.json:\n```json\n\"--env-file\", \"/Users/yildirimkaral/.fup-gitlab-mcp.env\"\n```\n\nThese should use:\n- Environment variables: `${GITLAB_MCP_ENV_FILE}`\n- Template placeholders: `{{GITLAB_MCP_ENV}}`\n- Or be moved to user-specific config outside the repo\n\nThis affects portability when others use the project.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-06T19:24:49.742546+01:00","created_by":"yildirimkaral","updated_at":"2026-01-06T19:24:49.742546+01:00"}
{"id":"budgie-gar","title":"Add test coverage for createHandler and frontmatter parsing","description":"Missing test coverage for critical components:\n\n1. **createHandler function** (cmd/server/main.go)\n   - Main business logic for tool calls\n   - Needs mock executor and session manager\n   - Test cases: success, error handling, fallback logic\n\n2. **frontmatter.go parsing edge cases**\n   - Malformed YAML\n   - Missing required fields\n   - Empty frontmatter\n   - No frontmatter delimiter\n\n3. **Integration test for full tool call flow**\n   - End-to-end test with real (or mocked) kiro-cli\n   - Verify response file handling\n   - Test session persistence\n\nExample test structure:\n```go\nfunc TestCreateHandler_Success(t *testing.T) {\n    mockExecutor := \u0026MockExecutor{Result: kiro.Result{Output: \"test\"}}\n    handler := createHandler(\"test\", \"model\", mockMgr, mockExecutor, cfg)\n    // Test happy path\n}\n```","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-06T19:24:41.406349+01:00","created_by":"yildirimkaral","updated_at":"2026-01-06T19:24:41.406349+01:00"}
{"id":"budgie-k0n","title":"Add stale session cleanup on startup","description":"Current behavior: Session cleanup only happens on graceful shutdown via signal handler.\n\nProblem: Orphaned Docker volumes and directories persist if process crashes.\n\nFix: Add startup cleanup for stale sessions:\n```go\nfunc (m *Manager) CleanupStale(maxAge time.Duration) {\n    // List sessions older than maxAge and remove them\n    // For sandbox: docker volume ls | grep budgie-session- | filter by age\n    // For normal: list directories in sessions dir, check mtime\n}\n```\n\nCall this at startup before registering tools.\n\nAlso document recovery command in README:\n```bash\ndocker volume ls -q | grep budgie-session- | xargs docker volume rm\n```","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-06T19:24:19.264021+01:00","created_by":"yildirimkaral","updated_at":"2026-01-06T19:24:19.264021+01:00"}
{"id":"budgie-lqf","title":"Implement response sharing without fs_read/fs_write requirement","description":"Current limitation: Every sub-agent requires fs_read and fs_write in allowedTools to write response files.\n\nThis is listed in README TODO as an architecture improvement.\n\nPotential approaches:\n1. **Direct stdout capture** - Current fallback, but less reliable\n2. **Structured output in stdout** - JSON/YAML format that budgie parses\n3. **MCP-level response interception** - Capture at protocol level\n4. **Custom protocol** - Environment variables or pipes for response data\n5. **Shared memory/tmpfs** - Agent writes to memory-mapped file\n\nBenefits:\n- Better security (agents don't need file system access)\n- More flexible agent permissions\n- Simpler agent configuration\n\nThis would require changes to:\n- executor.go (capture mechanism)\n- main.go (response handling)\n- _system.md (remove file write instructions)\n- All agent configs (remove fs_read/fs_write requirement)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-06T19:25:04.837299+01:00","created_by":"yildirimkaral","updated_at":"2026-01-06T19:25:04.837299+01:00"}
{"id":"budgie-n1o","title":"Migrate to structured logging (slog)","description":"Current logging uses log.Printf with no levels or structure:\n```go\nlog.Printf(\"Registered tool: %s (agent: %s)\", toolName, agentName)\n```\n\nMigrate to Go 1.21+ slog for structured logging:\n```go\nslog.Info(\"Registered tool\", \"name\", toolName, \"agent\", agentName)\nslog.Error(\"Execution failed\", \"agent\", agentName, \"error\", err, \"duration\", duration)\n```\n\nBenefits:\n- Log levels (debug, info, warn, error)\n- Structured fields for filtering/querying\n- JSON output option for log aggregation\n- Better debugging in production","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-06T19:24:33.040094+01:00","created_by":"yildirimkaral","updated_at":"2026-01-06T19:24:33.040094+01:00"}
{"id":"budgie-neh","title":"Add configuration validation at startup","description":"Current behavior: No validation of config values at startup. Invalid configs fail later during execution.\n\nAdd validation function:\n```go\nfunc validateConfig(cfg *config.Config) error {\n    if cfg.AgentTimeout \u003c time.Minute {\n        return fmt.Errorf(\"agent-timeout too short: %v (minimum 1m)\", cfg.AgentTimeout)\n    }\n    if cfg.SandboxEnabled \u0026\u0026 cfg.SandboxImage == \"\" {\n        return fmt.Errorf(\"sandbox-image required when sandbox enabled\")\n    }\n    if _, err := os.Stat(cfg.AgentsDir); os.IsNotExist(err) {\n        return fmt.Errorf(\"agents-dir does not exist: %s\", cfg.AgentsDir)\n    }\n    return nil\n}\n```\n\nCall in main() after parsing flags, before loading agents.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-06T19:24:26.037324+01:00","created_by":"yildirimkaral","updated_at":"2026-01-06T19:24:26.037324+01:00"}
{"id":"budgie-zhb","title":"Implement prompt sanitization for injection protection","description":"Implement prompt sanitization to prevent execution of malicious prompts.\n\nProtect against prompt injection attacks from:\n- fs_read - malicious content in files\n- web_fetch - malicious content from web pages  \n- web_search - malicious content in search results\n- Other external data sources\n\nConsider:\n- Input validation and filtering\n- Content escaping strategies\n- Sandboxing untrusted content\n- Rate limiting and abuse detection\n\nThis is listed in README TODO section as a security priority.","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-06T19:23:51.487071+01:00","created_by":"yildirimkaral","updated_at":"2026-01-06T19:23:51.487071+01:00"}
{"id":"budgie-zwv","title":"Fix response file race condition in sandbox mode","description":"In sandbox mode, response file is read immediately after execution without waiting for agent to finish writing.\n\nCurrent code:\n```go\nif content := readResponseFromVolume(sessionID, responseFile); content != \"\" {\n```\n\nIssue: Agent may still be writing when we read. No retry/wait logic.\n\nFix: Add polling with timeout:\n```go\nfunc readResponseWithRetry(sessionID, responseFile string, maxWait time.Duration) string {\n    deadline := time.Now().Add(maxWait)\n    for time.Now().Before(deadline) {\n        if content := readResponseFromVolume(sessionID, responseFile); content != \"\" {\n            return content\n        }\n        time.Sleep(100 * time.Millisecond)\n    }\n    return \"\"\n}\n```","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-06T19:24:12.102786+01:00","created_by":"yildirimkaral","updated_at":"2026-01-06T19:24:12.102786+01:00"}
